#!/usr/bin/env sh
file_path=/etc/modules-load.d/dasc-generated.conf
file_content=$(
	printf %s\\n "# DO NOT EDIT! This file is auto-generated by $0"

	sensors-detect --auto | LC_ALL=C awk 'BEGIN { state = 0 } {
		if($0 == "#----cut here----") {
			if(!state++) { print ""; next }
			exit
		}
		if(state) print $0
	}'
)

{ [ -e "$file_path" ] && printf %s\\n "$file_content" | cmp -s "$file_path"; } || {
	printf %s\\n "$file_content" > "$file_path" &&
	systemctl restart systemd-modules-load.service
}
